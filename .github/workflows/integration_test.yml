name: Integration Tests

on:
  schedule:
    # Run every day at 2AM UTC
    - cron: '0 2 * * *'
  workflow_dispatch:
    # Allow manual triggering

jobs:
  integration-test:
    if: ${{ github.repository == 'redpanda-data/connect' }}
    runs-on: ubuntu-latest
    env:
      CGO_ENABLED: 0
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Go
        uses: actions/setup-go@v5
        id: setup-go
        with:
          go-version: stable

      - name: Cache Task binary
        id: cache-task
        uses: actions/cache@v4
        with:
          path: ~/go/bin/task
          key: ${{ runner.os }}-go-task-binary-${{ steps.setup-go.outputs.go-version }}

      - name: Install Task
        if: steps.cache-task.outputs.cache-hit != 'true'
        run: |
          go install github.com/go-task/task/v3/cmd/task@latest

      - name: Run Integration Tests
        run: task test:integration
