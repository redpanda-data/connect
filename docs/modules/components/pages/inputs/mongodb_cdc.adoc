= mongodb_cdc
:type: input
:status: experimental



////
     THIS FILE IS AUTOGENERATED!

     To make changes, edit the corresponding source file under:

     https://github.com/redpanda-data/connect/tree/main/internal/impl/<provider>.

     And:

     https://github.com/redpanda-data/connect/tree/main/cmd/tools/docs_gen/templates/plugin.adoc.tmpl
////

// Â© 2024 Redpanda Data Inc.


component_type_dropdown::[]


Streams changes from a MongoDB replica set.


[tabs]
======
Common::
+
--

```yml
# Common config fields, showing default values
input:
  label: ""
  mongodb_cdc:
    url: mongodb://localhost:27017 # No default (required)
    database: "" # No default (required)
    username: ""
    password: ""
    collections: [] # No default (required)
    checkpoint_key: mongodb_cdc_checkpoint
    checkpoint_cache: "" # No default (required)
    checkpoint_interval: 5s
    checkpoint_limit: 1000
    read_batch_size: 1000
    read_max_wait: 1s
    stream_snapshot: false
    snapshot_parallelism: 1
    auto_replay_nacks: true
```

--
Advanced::
+
--

```yml
# All config fields, showing default values
input:
  label: ""
  mongodb_cdc:
    url: mongodb://localhost:27017 # No default (required)
    database: "" # No default (required)
    username: ""
    password: ""
    collections: [] # No default (required)
    checkpoint_key: mongodb_cdc_checkpoint
    checkpoint_cache: "" # No default (required)
    checkpoint_interval: 5s
    checkpoint_limit: 1000
    read_batch_size: 1000
    read_max_wait: 1s
    stream_snapshot: false
    snapshot_parallelism: 1
    snapshot_auto_bucket_sharding: false
    use_pre_and_post_images: false
    json_marshal_mode: canonical
    app_name: benthos
    auto_replay_nacks: true
```

--
======

Read from a MongoDB replica set using https://www.mongodb.com/docs/manual/changeStreams/[^Change Streams]. It's only possible to watch for changes when using a sharded MongoDB or a MongoDB cluster running as a replica set.

By default MongoDB does not propagate changes in all cases. In order to capture all changes (including deletes) in a MongoDB cluster one needs to enable pre and post image saving and the collection needs to also enable saving these pre and post images. For more information see https://www.mongodb.com/docs/manual/changeStreams/#change-streams-with-document-pre--and-post-images[^MongoDB documentation].

== Fields

=== `url`

The URL of the target MongoDB server.


*Type*: `string`


```yml
# Examples

url: mongodb://localhost:27017
```

=== `database`

The name of the target MongoDB database.


*Type*: `string`


=== `username`

The username to connect to the database.


*Type*: `string`

*Default*: `""`

=== `password`

The password to connect to the database.
[CAUTION]
====
This field contains sensitive information that usually shouldn't be added to a config directly, read our xref:configuration:secrets.adoc[secrets page for more info].
====



*Type*: `string`

*Default*: `""`

=== `collections`

The collections to stream changes from.


*Type*: `array`


=== `checkpoint_key`

Checkpoint cache key name.


*Type*: `string`

*Default*: `"mongodb_cdc_checkpoint"`

=== `checkpoint_cache`

Checkpoint cache name.


*Type*: `string`


=== `checkpoint_interval`

The interval between writing checkpoints to the cache.


*Type*: `string`

*Default*: `"5s"`

=== `checkpoint_limit`

Sorry! This field is missing documentation.


*Type*: `int`

*Default*: `1000`

=== `read_batch_size`

The batch size of documents for MongoDB to return.


*Type*: `int`

*Default*: `1000`

=== `read_max_wait`

The maximum time MongoDB waits to fulfill `read_batch_size` on the change stream before returning documents.


*Type*: `string`

*Default*: `"1s"`

=== `stream_snapshot`

If to read initial snapshot before streaming changes.


*Type*: `bool`

*Default*: `false`

=== `snapshot_parallelism`

Parallelism for snapshot phase.


*Type*: `int`

*Default*: `1`

=== `snapshot_auto_bucket_sharding`

If true, determine parallel snapshot chunks using `$bucketAuto` instead of the `splitVector` command. This allows parallel collection reading in environments where privledged access to the MongoDB cluster is not allowed such as MongoDB Atlas.


*Type*: `bool`

*Default*: `false`

=== `use_pre_and_post_images`

If true, enables uses pre and post images stored in MongoDB to ensure that updates and deletes have the full document. Otherwise update operations fetch the full current document and deletes only contain the document key.


*Type*: `bool`

*Default*: `false`

=== `json_marshal_mode`

The json_marshal_mode setting is optional and controls the format of the output message.


*Type*: `string`

*Default*: `"canonical"`

|===
| Option | Summary

| `canonical`
| A string format that emphasizes type preservation at the expense of readability and interoperability. That is, conversion from canonical to BSON will generally preserve type information except in certain specific cases. 
| `relaxed`
| A string format that emphasizes readability and interoperability at the expense of type preservation.That is, conversion from relaxed format to BSON can lose type information.

|===

=== `app_name`

The client application name.


*Type*: `string`

*Default*: `"benthos"`

=== `auto_replay_nacks`

Whether messages that are rejected (nacked) at the output level should be automatically replayed indefinitely, eventually resulting in back pressure if the cause of the rejections is persistent. If set to `false` these messages will instead be deleted. Disabling auto replays can greatly improve memory efficiency of high throughput streams as the original shape of the data can be discarded immediately upon consumption and mutation.


*Type*: `bool`

*Default*: `true`


