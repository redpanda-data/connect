---
project_name: redpanda-connect
dist: target/dist
version: 2

builds:
  - id: connect-cgo
    main: cmd/redpanda-connect/main.go
    binary: redpanda-connect
    goos: [ linux ]
    goarch: [ amd64 ]
    tags:
      - x_benthos_extra
    env:
      - CGO_ENABLED=1
    ldflags: >
      -X main.Version={{.Version}}
      -X main.DateBuilt={{.Date}}
      -X main.BinaryName=redpanda-connect
      -X github.com/redpanda-data/connect/v4/internal/telemetry.ExportHost={{ if index .Env "CONNECT_TELEMETRY_HOST"  }}{{ .Env.CONNECT_TELEMETRY_HOST }}{{ else }}{{ end }}
      -X github.com/redpanda-data/connect/v4/internal/telemetry.ExportDelay={{ if index .Env "CONNECT_TELEMETRY_DELAY"  }}{{ .Env.CONNECT_TELEMETRY_DELAY }}{{ else }}{{ end }}
      -X github.com/redpanda-data/connect/v4/internal/telemetry.ExportPeriod={{ if index .Env "CONNECT_TELEMETRY_PERIOD"  }}{{ .Env.CONNECT_TELEMETRY_PERIOD }}{{ else }}{{ end }}

archives:
  - id: connect-cgo
    ids: [ connect-cgo ]
    formats: tar.gz
    files:
      - README.md
      - CHANGELOG.md
      - licenses
    name_template: 'redpanda-connect-cgo_{{ .Version }}_{{ .Os }}_{{ .Arch }}{{ with .Arm }}v{{ . }}{{ end }}{{ with .Mips }}_{{ . }}{{ end }}{{ if not (eq .Amd64 "v1") }}{{ .Amd64 }}{{ end }}'

release:
  github:
    owner: redpanda-data
    name: connect
  prerelease: auto
  replace_existing_artifacts: true
  mode: keep-existing

checksum:
  split: true

